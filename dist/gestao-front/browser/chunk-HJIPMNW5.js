import{a as oe,b as ae}from"./chunk-RYGSPGTT.js";import{a as me}from"./chunk-WEVC5RLT.js";import{a as ce}from"./chunk-N5F4LVXF.js";import{a as ne,b as ie}from"./chunk-YF4REM46.js";import{a as te,b as re}from"./chunk-YCVRZCX4.js";import"./chunk-RK5QYF4B.js";import"./chunk-2AMZF5UH.js";import{A as z,B as H,F as K,G as Q,b as w,d as c,f as O,g as N,j as V,l as T,m as k,o as B,q as L,s as D,t as R,u as G,x as J}from"./chunk-7FJALMHQ.js";import{a as q,f as A,g as ee}from"./chunk-XAYXIGTK.js";import{a as P,c as X}from"./chunk-GN7WWOTY.js";import{Ab as x,Bb as F,Da as m,Ha as d,Oa as $,Ta as f,Za as s,a as b,cd as U,dd as W,e as pe,ed as Y,fc as y,fd as Z,gb as i,ha as C,hb as r,ia as h,ib as g,jc as I,mb as j,ob as v,pb as _,zb as a}from"./chunk-4P6AN2NL.js";var le=pe(ce());function ue(o,t){o&1&&g(0,"mat-progress-bar",5)}function fe(o,t){o&1&&(i(0,"mat-error"),a(1," Nome \xE9 obrigat\xF3rio "),r())}function de(o,t){o&1&&(i(0,"mat-error"),a(1," CPF/CNPJ \xE9 obrigat\xF3rio "),r())}function ge(o,t){o&1&&(i(0,"mat-error"),a(1," CPF inv\xE1lido "),r())}function _e(o,t){o&1&&(i(0,"mat-error"),a(1," CNPJ inv\xE1lido "),r())}function Ce(o,t){o&1&&(i(0,"mat-error"),a(1," Telefone \xE9 obrigat\xF3rio "),r())}function he(o,t){o&1&&(i(0,"mat-error"),a(1," Formato: (XX) XXXX-XXXX ou (XX) XXXXX-XXXX "),r())}function ve(o,t){o&1&&(i(0,"mat-error"),a(1," E-mail inv\xE1lido "),r())}function be(o,t){if(o&1){let e=j();i(0,"form",6),v("ngSubmit",function(){C(e);let p=_();return h(p.onSubmit())}),i(1,"mat-form-field",7)(2,"mat-label"),a(3,"Nome"),r(),g(4,"input",8),i(5,"mat-icon",9),a(6,"person"),r(),f(7,fe,2,0,"mat-error",10),r(),i(8,"div",11)(9,"mat-form-field",7)(10,"mat-label"),a(11,"CPF/CNPJ"),r(),i(12,"input",12),v("input",function(p){C(e);let u=_();return h(u.formatCpfCnpj(p))}),r(),i(13,"mat-icon",9),a(14,"fingerprint"),r(),f(15,de,2,0,"mat-error",10)(16,ge,2,0,"mat-error",10)(17,_e,2,0,"mat-error",10),r(),i(18,"mat-form-field",7)(19,"mat-label"),a(20,"Telefone"),r(),i(21,"input",13),v("input",function(p){C(e);let u=_();return h(u.formatPhone(p))}),r(),i(22,"mat-icon",9),a(23,"phone"),r(),f(24,Ce,2,0,"mat-error",10)(25,he,2,0,"mat-error",10),r()(),i(26,"mat-form-field",7)(27,"mat-label"),a(28,"E-mail"),r(),g(29,"input",14),i(30,"mat-icon",9),a(31,"email"),r(),f(32,ve,2,0,"mat-error",10),r(),i(33,"mat-form-field",7)(34,"mat-label"),a(35,"Endere\xE7o"),r(),g(36,"input",15),i(37,"mat-icon",9),a(38,"location_on"),r()(),i(39,"div",16)(40,"button",17)(41,"mat-icon"),a(42),r(),a(43),r()()()}if(o&2){let e,n,p,u,E,M,S,l=_();s("formGroup",l.form),m(7),s("ngIf",(e=l.form.get("nome"))==null?null:e.hasError("required")),m(8),s("ngIf",(n=l.form.get("cpf_cnpj"))==null?null:n.hasError("required")),m(),s("ngIf",(p=l.form.get("cpf_cnpj"))==null?null:p.hasError("invalidCpf")),m(),s("ngIf",(u=l.form.get("cpf_cnpj"))==null?null:u.hasError("invalidCnpj")),m(7),s("ngIf",(E=l.form.get("telefone"))==null?null:E.hasError("required")),m(),s("ngIf",(M=l.form.get("telefone"))==null?null:M.hasError("pattern")),m(7),s("ngIf",(S=l.form.get("email"))==null?null:S.hasError("email")),m(8),s("disabled",l.isLoading),m(2),x(l.isEdit?"save":"add"),m(),F(" ",l.isEdit?"Salvar":"Criar"," ")}}function xe(o,t){o&1&&(i(0,"div",18),g(1,"mat-spinner",19),r())}var se=class o{constructor(t,e,n,p,u){this.fb=t;this.api=e;this.router=n;this.route=p;this.snackBar=u}form;isEdit=!1;isLoading=!1;cpf_cnpj;ngOnInit(){this.form=this.fb.group({nome:["",c.required],cpf_cnpj:["",[c.required,this.validateCpfCnpj]],email:["",[c.required,c.email]],telefone:["",[c.required,c.pattern(/^\(\d{2}\) \d{4,5}-\d{4}$/)]],endereco:["",c.required]}),this.cpf_cnpj=this.route.snapshot.paramMap.get("cpf_cnpj")||void 0,this.cpf_cnpj&&(this.isLoading=!0,this.isEdit=!0,this.api.getCustomer(this.cpf_cnpj).subscribe({next:e=>{this.form.patchValue(e),this.isLoading=!1},error:e=>{this.showError("Erro ao carregar venda"),this.isLoading=!1}}));let t=this.route.snapshot.paramMap.get("cpf_cnpj");t&&(this.isLoading=!0,this.isEdit=!0,this.cpf_cnpj=t,this.api.getCustomer(this.cpf_cnpj).subscribe({next:e=>{let n=b({},e);n.cpf_cnpj&&(n.cpf_cnpj.length<=11?n.cpf_cnpj=this.applyCpfMask(String(n.cpf_cnpj)):n.cpf_cnpj.length>11&&(n.cpf_cnpj=this.applyCnpjMask(String(n.cpf_cnpj)))),this.form.patchValue(n),this.isLoading=!1},error:e=>{this.showError("Erro ao carregar venda"),this.isLoading=!1}}))}applyCnpjMask(t){let e=t.replace(/\D/g,"").substring(0,14);return e.length===0?"":e.length<=2?e:e.length<=5?`${e.substring(0,2)}.${e.substring(2)}`:e.length<=8?`${e.substring(0,2)}.${e.substring(2,5)}.${e.substring(5)}`:e.length<=12?`${e.substring(0,2)}.${e.substring(2,5)}.${e.substring(5,8)}/${e.substring(8)}`:`${e.substring(0,2)}.${e.substring(2,5)}.${e.substring(5,8)}/${e.substring(8,12)}-${e.substring(12,14)}`}applyCpfMask(t){let e=t.replace(/\D/g,"").substring(0,11);return e.length===0?"":e.length<=3?e:e.length<=6?`${e.substring(0,3)}.${e.substring(3)}`:e.length<=9?`${e.substring(0,3)}.${e.substring(3,6)}.${e.substring(6)}`:`${e.substring(0,3)}.${e.substring(3,6)}.${e.substring(6,9)}-${e.substring(9,11)}`}validateCpfCnpj(t){let e=t.value.replace(/\D/g,"");return e.length===11&&!(0,le.isValid)(e)?{invalidCpf:!0}:e.length===14&&!me(e)?{invalidCnpj:!0}:null}formatCpfCnpj(t){let e=t.target.value.replace(/\D/g,"");e.length<=11?(e.length>3&&(e=e.replace(/^(\d{3})(\d)/,"$1.$2")),e.length>6&&(e=e.replace(/^(\d{3})\.(\d{3})(\d)/,"$1.$2.$3")),e.length>9&&(e=e.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/,"$1.$2.$3-$4"))):(e=e.replace(/^(\d{2})(\d)/,"$1.$2"),e=e.replace(/^(\d{2})\.(\d{3})(\d)/,"$1.$2.$3"),e=e.replace(/\.(\d{3})(\d)/,".$1/$2"),e=e.replace(/(\d{4})(\d)/,"$1-$2")),this.form.get("cpf_cnpj")?.setValue(e.substring(0,18),{emitEvent:!1})}formatPhone(t){let e=t.target.value.replace(/\D/g,"");e.length>2&&(e=`(${e.substring(0,2)}) ${e.substring(2)}`),e.length>10&&(e=`${e.substring(0,10)}-${e.substring(10,14)}`),this.form.get("telefone")?.setValue(e.substring(0,15),{emitEvent:!1})}onSubmit(){if(this.form.invalid){Object.values(this.form.controls).forEach(n=>{n.markAsTouched()}),this.showError("Por favor, preencha todos os campos obrigat\xF3rios");return}this.isLoading=!0;let t=b({},this.form.value);t.cpf_cnpj&&(t.cpf_cnpj=String(t.cpf_cnpj).replace(/\D/g,"")),console.log(t),(this.isEdit?this.api.updateCustomer(this.cpf_cnpj,t):this.api.createCustomer(t)).subscribe({next:n=>{this.showSuccess("Cliente salvo com sucesso!"),this.router.navigate(["/clientes"])},error:n=>{this.showError("Erro ao salvar cliente. Por favor, tente novamente."),this.isLoading=!1}})}showError(t){this.snackBar.open(t,"Fechar",{duration:5e3,panelClass:["error-snackbar"]})}showSuccess(t){this.snackBar.open(t,"Fechar",{duration:3e3,panelClass:["success-snackbar"]})}static \u0275fac=function(e){return new(e||o)(d(L),d(ee),d(X),d(P),d(ne))};static \u0275cmp=$({type:o,selectors:[["app-customer-form"]],decls:7,vars:4,consts:[[1,"form-card"],[1,"form-header"],["mode","indeterminate","color","accent",4,"ngIf"],["class","form-content",3,"formGroup","ngSubmit",4,"ngIf"],["class","loading-overlay",4,"ngIf"],["mode","indeterminate","color","accent"],[1,"form-content",3,"ngSubmit","formGroup"],["appearance","outline",1,"form-field"],["matInput","","formControlName","nome","required",""],["matSuffix",""],[4,"ngIf"],[1,"form-row"],["matInput","","formControlName","cpf_cnpj","required","",3,"input"],["matInput","","formControlName","telefone","placeholder","(XX) XXXX-XXXX","required","",3,"input"],["matInput","","formControlName","email","type","email"],["matInput","","formControlName","endereco"],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",1,"submit-button",3,"disabled"],[1,"loading-overlay"],["diameter","50","color","accent"]],template:function(e,n){e&1&&(i(0,"mat-card",0)(1,"div",1)(2,"h2"),a(3),r(),f(4,ue,1,0,"mat-progress-bar",2),r(),f(5,be,44,11,"form",3)(6,xe,2,0,"div",4),r()),e&2&&(m(3),x(n.isEdit?"Editar Cliente":"Novo Cliente"),m(),s("ngIf",n.isLoading),m(),s("ngIf",!n.isLoading),m(),s("ngIf",n.isLoading))},dependencies:[I,y,D,V,w,O,N,B,T,k,A,q,H,z,R,G,J,Q,K,W,U,ie,re,te,ae,oe,Z,Y],styles:[".form-card[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:2rem;border-radius:16px;overflow:hidden}.form-header[_ngcontent-%COMP%]{margin-bottom:2rem}.form-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:.5rem}.form-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1.5rem}.form-row[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{flex:1}.form-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary)}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem}.submit-button[_ngcontent-%COMP%]{min-width:120px}.cancel-button[_ngcontent-%COMP%]{border-color:var(--text-secondary);color:var(--text-secondary)}.loading-overlay[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:300px}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:1.5rem;margin:1rem}.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.submit-button[_ngcontent-%COMP%], .cancel-button[_ngcontent-%COMP%]{width:100%}}"]})};export{se as CustomerFormComponent};
