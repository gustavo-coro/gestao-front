import"./chunk-MS4AQ6UA.js";import{a as wt,b as Tt}from"./chunk-YF4REM46.js";import{c as Ot}from"./chunk-UQLF6CA5.js";import{a as Ft,b as yt,c as It}from"./chunk-JKG6SBN7.js";import{a as _t,b as gt,c as ht,d as Ct,e as xt,f as Pt,g as Mt,h as vt,i as bt,j as Et,k as St}from"./chunk-QR3VN75N.js";import"./chunk-EKXEQYR4.js";import"./chunk-RK5QYF4B.js";import"./chunk-2AMZF5UH.js";import{A as it,B as at,F as mt,G as lt,b as L,d as p,f as H,g as z,j as G,k as Q,l as U,m as J,n as K,o as W,q as X,s as Y,t as et,u as nt,w as rt,x as ot}from"./chunk-7FJALMHQ.js";import{a as Z,f as tt,g as ft}from"./chunk-XAYXIGTK.js";import{Ab as s,Bb as V,Cb as B,Da as m,E as q,Ha as S,Kb as y,Mb as I,Oa as N,R as h,Ta as d,Za as l,ad as dt,cd as ct,dd as ut,ec as $,ed as pt,fc as j,fd as st,gb as r,ha as b,hb as n,ia as E,ib as f,ic as R,jb as _,jc as A,k as D,kb as g,mb as F,ob as C,pb as x,y as k,zb as o}from"./chunk-4P6AN2NL.js";function kt(t,e){t&1&&(r(0,"mat-error"),o(1," Nome \xE9 obrigat\xF3rio "),n())}function qt(t,e){t&1&&(r(0,"mat-error"),o(1," Quantidade \xE9 obrigat\xF3ria "),n())}function Nt(t,e){t&1&&(r(0,"mat-error"),o(1," Quantidade deve ser positiva "),n())}function Vt(t,e){t&1&&(r(0,"mat-error"),o(1," Valor de custo \xE9 obrigat\xF3rio "),n())}function Bt(t,e){t&1&&(r(0,"mat-error"),o(1," Valor de custo deve ser positivo "),n())}function $t(t,e){t&1&&(r(0,"mat-error"),o(1," Valor de venda \xE9 obrigat\xF3rio "),n())}function jt(t,e){t&1&&(r(0,"mat-error"),o(1," Valor de venda deve ser positivo "),n())}function Rt(t,e){if(t&1&&(r(0,"mat-option",35),o(1),n()),t&2){let a=e.$implicit;l("value",a.cpf_cnpj_fornecedor),m(),B(" ",a.nome_fornecedor," (",a.cpf_cnpj_fornecedor,") ")}}function At(t,e){t&1&&(r(0,"mat-error"),o(1," Fornecedor \xE9 obrigat\xF3rio "),n())}function Lt(t,e){if(t&1){let a=F();r(0,"button",36),C("click",function(){b(a);let c=x();return E(c.resetForm())}),r(1,"mat-icon"),o(2,"cancel"),n(),o(3," Cancelar "),n()}}function Ht(t,e){t&1&&(r(0,"th",37),o(1,"Nome"),n())}function zt(t,e){if(t&1&&(r(0,"td",38),o(1),n()),t&2){let a=e.$implicit;m(),s(a.nome_produto)}}function Gt(t,e){t&1&&(r(0,"th",37),o(1,"Estoque"),n())}function Qt(t,e){if(t&1&&(r(0,"td",38),o(1),n()),t&2){let a=e.$implicit;m(),s(a.qtd_produto)}}function Ut(t,e){t&1&&(r(0,"th",37),o(1,"Custo"),n())}function Jt(t,e){if(t&1&&(r(0,"td",39),o(1),y(2,"currency"),n()),t&2){let a=e.$implicit;m(),s(I(2,1,a.valor_custo,"BRL"))}}function Kt(t,e){t&1&&(r(0,"th",37),o(1,"Venda"),n())}function Wt(t,e){if(t&1&&(r(0,"td",39),o(1),y(2,"currency"),n()),t&2){let a=e.$implicit;m(),s(I(2,1,a.valor_venda,"BRL"))}}function Xt(t,e){t&1&&(r(0,"th",37),o(1,"Fornecedor"),n())}function Yt(t,e){if(t&1&&(r(0,"td",38),o(1),n()),t&2){let a=e.$implicit,i=x();m(),s(i.getSupplierName(a.fk_cpf_cnpj_fornecedor))}}function Zt(t,e){t&1&&(r(0,"th",40),o(1,"A\xE7\xF5es"),n())}function te(t,e){if(t&1){let a=F();r(0,"td",41)(1,"button",42),C("click",function(){let c=b(a).$implicit,u=x();return E(u.editProduct(c))}),r(2,"mat-icon"),o(3,"edit"),n()(),r(4,"button",43),C("click",function(){let c=b(a).$implicit,u=x();return E(u.deleteProduct(c.id_produto))}),r(5,"mat-icon"),o(6,"delete"),n()()()}}function ee(t,e){t&1&&f(0,"tr",44)}function ne(t,e){t&1&&f(0,"tr",45)}function re(t,e){t&1&&(r(0,"div",46)(1,"mat-icon"),o(2,"search_off"),n(),r(3,"p"),o(4,"Nenhum produto encontrado com os filtros aplicados"),n()())}function oe(t,e){t&1&&(r(0,"div",46)(1,"mat-icon"),o(2,"inventory"),n(),r(3,"p"),o(4,"Nenhum produto cadastrado"),n()())}var Dt=class t{constructor(e,a,i){this.fb=e;this.api=a;this.snackBar=i;this.productForm=this.fb.group({nome_produto:["",p.required],qtd_produto:["",[p.required,p.min(0)]],valor_custo:["",[p.required,p.min(0)]],valor_venda:["",[p.required,p.min(0)]],fk_cpf_cnpj_fornecedor:["",p.required]}),this.filterForm=this.fb.group({nomeProdutoFilter:[""],fornecedorFilter:[""]})}productForm;filterForm;allProducts=[];filteredProducts=[];suppliers=[];displayedColumns=["nome_produto","qtd_produto","valor_custo","valor_venda","fornecedor","actions"];editingProductId=null;destroy$=new D;ngOnInit(){this.loadInitialData(),this.setupFilters()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadInitialData(){k({products:this.api.getProducts(),suppliers:this.api.getSuppliers()}).pipe(h(this.destroy$)).subscribe({next:({products:e,suppliers:a})=>{this.allProducts=e,this.suppliers=a,this.applyFilters()},error:e=>{console.error("Erro ao carregar dados iniciais:",e),this.snackBar.open("Erro ao carregar dados da p\xE1gina.","Fechar",{duration:3e3})}})}setupFilters(){this.filterForm.valueChanges.pipe(q(300),h(this.destroy$)).subscribe(()=>{this.applyFilters()})}applyFilters(){let{nomeProdutoFilter:e,fornecedorFilter:a}=this.filterForm.value,i=e?.toLowerCase()||"",c=a?.toLowerCase()||"";this.filteredProducts=this.allProducts.filter(u=>{let P=i?u.nome_produto.toLowerCase().includes(i):!0,M=this.getSupplierName(u.fk_cpf_cnpj_fornecedor).toLowerCase(),v=c?M.includes(c)||u.fk_cpf_cnpj_fornecedor.includes(c):!0;return P&&v})}clearFilters(){this.filterForm.reset({nomeProdutoFilter:"",fornecedorFilter:""})}onSubmit(){if(this.productForm.invalid){this.snackBar.open("Por favor, preencha todos os campos obrigat\xF3rios.","Fechar",{duration:3e3});return}let e=this.productForm.value;(this.editingProductId!==null?this.api.updateProduct(this.editingProductId,e):this.api.createProduct(e)).pipe(h(this.destroy$)).subscribe({next:()=>{let i=this.editingProductId?"Produto atualizado com sucesso!":"Produto cadastrado com sucesso!";this.snackBar.open(i,"Fechar",{duration:3e3}),this.resetForm(),this.loadInitialData()},error:i=>this.handleApiError(i,this.editingProductId?"atualizar":"cadastrar")})}handleApiError(e,a){console.error(`Erro ao ${a} produto:`,e),this.snackBar.open(`Erro ao ${a} o produto. Verifique os dados e tente novamente.`,"Fechar",{duration:3e3})}editProduct(e){if(e.id_produto===void 0){this.snackBar.open("Produto sem ID n\xE3o pode ser editado.","Fechar",{duration:3e3});return}this.editingProductId=e.id_produto,this.productForm.patchValue(e),window.scrollTo(0,0)}deleteProduct(e){if(e===void 0){this.snackBar.open("ID do produto inv\xE1lido para exclus\xE3o.","Fechar",{duration:3e3});return}confirm("Tem certeza que deseja excluir este produto?")&&this.api.deleteProduct(e).pipe(h(this.destroy$)).subscribe({next:()=>{this.snackBar.open("Produto exclu\xEDdo com sucesso!","Fechar",{duration:3e3}),this.editingProductId===e&&this.resetForm(),this.loadInitialData()},error:a=>this.handleApiError(a,"excluir")})}resetForm(){this.productForm.reset(),this.editingProductId=null,Object.keys(this.productForm.controls).forEach(e=>{this.productForm.get(e)?.setErrors(null),this.productForm.get(e)?.markAsUntouched(),this.productForm.get(e)?.markAsPristine()})}getSupplierName(e){return this.suppliers.find(i=>i.cpf_cnpj_fornecedor===e)?.nome_fornecedor||e}static \u0275fac=function(a){return new(a||t)(S(X),S(ft),S(wt))};static \u0275cmp=N({type:t,selectors:[["app-product-management"]],decls:80,vars:20,consts:[[1,"form-card"],[1,"form-header"],[1,"form-content",3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","nome_produto","required",""],["matSuffix",""],[4,"ngIf"],["matInput","","type","number","formControlName","qtd_produto","required","","min","0"],["matInput","","type","number","formControlName","valor_custo","required","","min","0","step","0.01"],["matPrefix",""],["matInput","","type","number","formControlName","valor_venda","required","","min","0","step","0.01"],["formControlName","fk_cpf_cnpj_fornecedor","required",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["mat-stroked-button","","type","button","class","cancel-button",3,"click",4,"ngIf"],["mat-raised-button","","color","primary","type","submit",1,"submit-button",3,"disabled"],[1,"list-card"],[1,"list-header"],[1,"table-container"],["mat-table","",1,"full-table","mat-elevation-z4",3,"dataSource"],["matColumnDef","nome_produto"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","qtd_produto"],["matColumnDef","valor_custo"],["mat-cell","","class","text-right",4,"matCellDef"],["matColumnDef","valor_venda"],["matColumnDef","fornecedor"],["matColumnDef","actions"],["mat-header-cell","","class","text-center",4,"matHeaderCellDef"],["mat-cell","","class","text-center",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","no-results",4,"ngIf"],[3,"value"],["mat-stroked-button","","type","button",1,"cancel-button",3,"click"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"text-right"],["mat-header-cell","",1,"text-center"],["mat-cell","",1,"text-center"],["mat-icon-button","","color","primary","matTooltip","Editar Produto",3,"click"],["mat-icon-button","","color","warn","matTooltip","Excluir Produto",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-results"]],template:function(a,i){if(a&1&&(r(0,"mat-card",0)(1,"div",1)(2,"h2"),o(3),n()(),r(4,"form",2),C("ngSubmit",function(){return i.onSubmit()}),r(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),o(8,"Nome do Produto"),n(),f(9,"input",5),r(10,"mat-icon",6),o(11,"inventory_2"),n(),d(12,kt,2,0,"mat-error",7),n(),r(13,"mat-form-field",4)(14,"mat-label"),o(15,"Quantidade em Estoque"),n(),f(16,"input",8),r(17,"mat-icon",6),o(18,"numbers"),n(),d(19,qt,2,0,"mat-error",7)(20,Nt,2,0,"mat-error",7),n()(),r(21,"div",3)(22,"mat-form-field",4)(23,"mat-label"),o(24,"Valor de Custo"),n(),f(25,"input",9),r(26,"span",10),o(27,"R$\xA0"),n(),d(28,Vt,2,0,"mat-error",7)(29,Bt,2,0,"mat-error",7),n(),r(30,"mat-form-field",4)(31,"mat-label"),o(32,"Valor de Venda"),n(),f(33,"input",11),r(34,"span",10),o(35,"R$\xA0"),n(),d(36,$t,2,0,"mat-error",7)(37,jt,2,0,"mat-error",7),n()(),r(38,"mat-form-field",4)(39,"mat-label"),o(40,"Fornecedor"),n(),r(41,"mat-select",12),d(42,Rt,2,3,"mat-option",13),n(),r(43,"mat-icon",6),o(44,"local_shipping"),n(),d(45,At,2,0,"mat-error",7),n(),r(46,"div",14),d(47,Lt,4,0,"button",15),r(48,"button",16)(49,"mat-icon"),o(50),n(),o(51),n()()()(),r(52,"mat-card",17)(53,"div",18)(54,"h3"),o(55,"Lista de Produtos"),n()(),r(56,"div",19)(57,"table",20),_(58,21),d(59,Ht,2,0,"th",22)(60,zt,2,1,"td",23),g(),_(61,24),d(62,Gt,2,0,"th",22)(63,Qt,2,1,"td",23),g(),_(64,25),d(65,Ut,2,0,"th",22)(66,Jt,3,4,"td",26),g(),_(67,27),d(68,Kt,2,0,"th",22)(69,Wt,3,4,"td",26),g(),_(70,28),d(71,Xt,2,0,"th",22)(72,Yt,2,1,"td",23),g(),_(73,29),d(74,Zt,2,0,"th",30)(75,te,7,0,"td",31),g(),d(76,ee,1,0,"tr",32)(77,ne,1,0,"tr",33),n(),d(78,re,5,0,"div",34)(79,oe,5,0,"div",34),n()()),a&2){let c,u,P,M,v,O,w,T;m(3),s(i.editingProductId?"Editar Produto":"Cadastrar Novo Produto"),m(),l("formGroup",i.productForm),m(8),l("ngIf",(c=i.productForm.get("nome_produto"))==null?null:c.hasError("required")),m(7),l("ngIf",(u=i.productForm.get("qtd_produto"))==null?null:u.hasError("required")),m(),l("ngIf",(P=i.productForm.get("qtd_produto"))==null?null:P.hasError("min")),m(8),l("ngIf",(M=i.productForm.get("valor_custo"))==null?null:M.hasError("required")),m(),l("ngIf",(v=i.productForm.get("valor_custo"))==null?null:v.hasError("min")),m(7),l("ngIf",(O=i.productForm.get("valor_venda"))==null?null:O.hasError("required")),m(),l("ngIf",(w=i.productForm.get("valor_venda"))==null?null:w.hasError("min")),m(5),l("ngForOf",i.suppliers),m(3),l("ngIf",(T=i.productForm.get("fk_cpf_cnpj_fornecedor"))==null?null:T.hasError("required")),m(2),l("ngIf",i.editingProductId),m(),l("disabled",i.productForm.invalid),m(2),s(i.editingProductId?"save":"add"),m(),V(" ",i.editingProductId?"Atualizar Produto":"Salvar Produto"," "),m(6),l("dataSource",i.filteredProducts),m(19),l("matHeaderRowDef",i.displayedColumns),m(),l("matRowDefColumns",i.displayedColumns),m(),l("ngIf",i.filteredProducts.length===0&&i.allProducts.length>0),m(),l("ngIf",i.allProducts.length===0)}},dependencies:[A,$,j,R,Y,G,L,Q,H,z,W,K,U,J,tt,Z,at,it,et,nt,rt,ot,lt,mt,ut,ct,dt,St,_t,ht,Mt,Ct,gt,vt,xt,Pt,bt,Et,It,yt,Ft,st,pt,Tt,Ot],styles:[".form-card[_ngcontent-%COMP%], .filter-card[_ngcontent-%COMP%], .list-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:24px;margin:16px auto;box-shadow:0 4px 20px #00000014;max-width:1200px}.form-header[_ngcontent-%COMP%], .filter-header[_ngcontent-%COMP%], .list-header[_ngcontent-%COMP%]{margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid rgba(67,97,238,.1)}.form-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .filter-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .list-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:var(--primary-color);margin:0}.form-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1.5rem}.form-row[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{flex:1}.form-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary)}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem}.submit-button[_ngcontent-%COMP%]{min-width:180px}.cancel-button[_ngcontent-%COMP%]{border-color:var(--text-secondary);color:var(--text-secondary)}.filter-container[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center;flex-wrap:wrap;background:#4361ee0d;padding:16px;border-radius:12px}.filter-field[_ngcontent-%COMP%]{flex:1;min-width:250px}.clear-button[_ngcontent-%COMP%]{height:56px}.table-container[_ngcontent-%COMP%]{border-radius:12px;overflow:hidden;margin:24px 0;box-shadow:0 2px 16px #00000014}.full-table[_ngcontent-%COMP%]{width:100%}.text-right[_ngcontent-%COMP%]{text-align:right}.text-center[_ngcontent-%COMP%]{text-align:center}.no-results[_ngcontent-%COMP%]{text-align:center;padding:32px;color:var(--text-secondary);font-size:1.1rem}.no-results[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;opacity:.6}.no-results[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}@media (max-width: 768px){.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.filter-container[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filter-field[_ngcontent-%COMP%], .clear-button[_ngcontent-%COMP%]{width:100%}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.submit-button[_ngcontent-%COMP%], .cancel-button[_ngcontent-%COMP%]{width:100%}}"]})};export{Dt as ProductManagementComponent};
