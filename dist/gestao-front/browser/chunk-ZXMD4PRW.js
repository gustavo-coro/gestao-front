import{c as ye,d as Ce,e as be,f as Fe,g as xe}from"./chunk-V3P5FM7H.js";import"./chunk-MS4AQ6UA.js";import{a as Ie}from"./chunk-JBCGYZPP.js";import{b as ve}from"./chunk-GRPTZ3TI.js";import{c as he}from"./chunk-PT4NCSO5.js";import"./chunk-SH2TLVCK.js";import"./chunk-FO32T2ZT.js";import"./chunk-PBNEBNJG.js";import{A as pe,B as de,F as ue,G as fe,b as H,d as p,f as U,g as W,j as Y,k as Z,l as z,m as J,n as K,o as Q,p as ee,q as te,s as re,t as oe,u as ne,w as me,x as le}from"./chunk-KWAF5XDU.js";import{a as ie,f as ae,g as Ee}from"./chunk-EMEIIDOM.js";import{a as G,c as L}from"./chunk-BB7POGC6.js";import{Ab as b,Bb as B,Da as m,Ha as _,Oa as A,Ta as u,Za as l,a as h,b as y,cd as se,dd as ce,e as De,ed as _e,fc as R,fd as ge,gb as a,ha as g,hb as t,ia as E,ib as f,jc as j,mb as $,ob as v,yb as C,zb as o}from"./chunk-MQA6ALZQ.js";var Me=De(Ie());function Pe(n,e){n&1&&(a(0,"mat-error"),o(1," Nome \xE9 obrigat\xF3rio "),t())}function Te(n,e){n&1&&(a(0,"mat-error"),o(1," CPF \xE9 obrigat\xF3rio "),t())}function qe(n,e){n&1&&(a(0,"mat-error"),o(1," CPF inv\xE1lido "),t())}function Ne(n,e){n&1&&(a(0,"mat-error"),o(1," E-mail \xE9 obrigat\xF3rio "),t())}function ke(n,e){n&1&&(a(0,"mat-error"),o(1," Formato de e-mail inv\xE1lido "),t())}function we(n,e){n&1&&(a(0,"mat-error"),o(1," E-mail deve terminar com .com "),t())}function Oe(n,e){n&1&&(a(0,"mat-error"),o(1," Telefone \xE9 obrigat\xF3rio "),t())}function Ve(n,e){n&1&&(a(0,"mat-error"),o(1," Formato: (XX) XXXXX-XXXX "),t())}function Xe(n,e){n&1&&(a(0,"mat-error"),o(1," Endere\xE7o \xE9 obrigat\xF3rio "),t())}function Ae(n,e){n&1&&(a(0,"mat-error"),o(1," Contrato \xE9 obrigat\xF3rio "),t())}function $e(n,e){n&1&&(a(0,"mat-error"),o(1," Cargo \xE9 obrigat\xF3rio "),t())}function Be(n,e){n&1&&(a(0,"mat-error"),o(1," Data deve ser futura "),t())}function Re(n,e){n&1&&(a(0,"mat-error"),o(1," Data deve ser passada "),t())}function je(n,e){n&1&&(a(0,"mat-error"),o(1," M\xEDnimo R$ 1.320,00 "),t())}function Ge(n,e){n&1&&(a(0,"mat-error"),o(1," Senha \xE9 obrigat\xF3ria "),t())}function Le(n,e){n&1&&(a(0,"mat-error"),o(1," M\xEDnimo 8 caracteres "),t())}var Se=class n{constructor(e,r,i,d){this.fb=e;this.api=r;this.router=i;this.route=d}form;isEdit=!1;cpf;ngOnInit(){this.form=this.fb.group({nome:["",p.required],email:["",[p.required,p.email,this.validateCompanyEmail]],cpf:["",[p.required,this.validateCPF]],telefone:["",[p.required,p.pattern(/^\(\d{2}\) \d{4,5}-\d{4}$/)]],endereco:["",p.required],contrato:["",p.required],data_pagamento:["",[p.required,this.futureDateValidator]],data_ferias:["",[p.required,this.pastDateValidator]],salario:["",[p.required,p.min(1320)]],senha:["",[p.required,p.minLength(8)]],role:["",p.required]}),this.cpf=this.route.snapshot.paramMap.get("cpf")||void 0,this.cpf&&(this.isEdit=!0,this.api.getEmployee(this.cpf).subscribe(e=>{let r=y(h({},e),{data_pagamento:e.data_pagamento?this.parseBackendDate(e.data_pagamento):null,data_ferias:e.data_ferias?this.parseBackendDate(e.data_ferias):null});this.form.patchValue(r),this.form.get("cpf")?.disable()}))}validateCPF=e=>e.value?(0,Me.isValid)(e.value)?null:{invalidCpf:!0}:null;validateCompanyEmail=e=>{let r=e.value;return r?r.endsWith(".com")?null:{invalidCompanyEmail:!0}:null};futureDateValidator=e=>{if(!e.value)return null;let r=new Date(e.value),i=new Date;return i.setHours(0,0,0,0),r>i?null:{pastDate:!0}};pastDateValidator=e=>{if(!e.value)return null;let r=new Date(e.value),i=new Date;return i.setHours(0,0,0,0),r<i?null:{futureDate:!0}};formatCPF=e=>{let r=e.target.value.replace(/\D/g,"");r.length>3&&(r=r.replace(/^(\d{3})(\d)/,"$1.$2")),r.length>6&&(r=r.replace(/^(\d{3})\.(\d{3})(\d)/,"$1.$2.$3")),r.length>9&&(r=r.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d)/,"$1.$2.$3-$4")),this.form.get("cpf")?.setValue(r.substring(0,14),{emitEvent:!1})};formatPhone=e=>{let r=e.target.value.replace(/\D/g,"");r.length>2&&(r=`(${r.substring(0,2)}) ${r.substring(2)}`),r.length>9&&(r=`${r.substring(0,9)}-${r.substring(9,14)}`),this.form.get("telefone")?.setValue(r.substring(0,15),{emitEvent:!1})};parseBackendDate(e){let[r,i,d]=e.split("T")[0].split("-").map(Number);return new Date(r,i-1,d)}convertToBackendFormat(e){if(!e||!(e instanceof Date)||isNaN(e.getTime()))return null;let r=e.getFullYear(),i=("0"+(e.getMonth()+1)).slice(-2),d=("0"+e.getDate()).slice(-2);return`${r}-${i}-${d}`}onSubmit(){if(this.form.invalid){Object.values(this.form.controls).forEach(e=>{e.markAsTouched()}),console.error("Formul\xE1rio inv\xE1lido. N\xE3o foi enviado.");return}if(this.isEdit&&this.cpf){let e={},r=this.form.getRawValue();if(Object.keys(r).forEach(i=>{let d=this.form.get(i);d&&d.dirty&&(e[i]=r[i])}),Object.keys(e).length===0){console.log("Nenhum dado foi alterado. Navegando de volta."),this.router.navigate(["/funcionario"]);return}e.data_pagamento&&(e.data_pagamento=this.convertToBackendFormat(new Date(e.data_pagamento))),e.data_ferias&&(e.data_ferias=this.convertToBackendFormat(new Date(e.data_ferias))),console.log("Enviando apenas os dados alterados:",e),this.api.updateEmployee(this.cpf,e).subscribe({next:()=>this.router.navigate(["/funcionario"]),error:i=>console.error("Erro ao ATUALIZAR funcion\xE1rio:",i)})}else{let e=y(h({},this.form.value),{data_pagamento:this.convertToBackendFormat(this.form.value.data_pagamento),data_ferias:this.convertToBackendFormat(this.form.value.data_ferias)});console.log("Enviando dados para criar novo funcion\xE1rio:",e),this.api.createEmployee(e).subscribe({next:()=>this.router.navigate(["/funcionario"]),error:r=>console.error("Erro ao CRIAR funcion\xE1rio:",r)})}}static \u0275fac=function(r){return new(r||n)(_(te),_(Ee),_(L),_(G))};static \u0275cmp=A({type:n,selectors:[["app-employee-form"]],decls:99,vars:26,consts:[["pickerPagamento",""],["pickerFerias",""],[1,"form-card"],[1,"form-header"],[1,"form-content",3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","nome","required",""],["matSuffix",""],[4,"ngIf"],["matInput","","formControlName","cpf","placeholder","000.000.000-00","required","",3,"input"],["matInput","","formControlName","email","type","email","required",""],["matInput","","formControlName","telefone","placeholder","(XX) XXXX-XXXX","required","",3,"input"],["matInput","","formControlName","endereco","required",""],["matInput","","formControlName","contrato","required",""],["matInput","","formControlName","role","required",""],["matInput","","formControlName","data_pagamento","required","",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","data_ferias",3,"matDatepicker"],["matInput","","formControlName","salario","type","number","step","0.01","min","1320","required",""],["matPrefix",""],["matInput","","formControlName","senha","type","password","minlength","8",3,"required"],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",1,"submit-button",3,"disabled"]],template:function(r,i){if(r&1){let d=$();a(0,"mat-card",2)(1,"div",3)(2,"h2"),o(3),t()(),a(4,"form",4),v("ngSubmit",function(){return g(d),E(i.onSubmit())}),a(5,"div",5)(6,"mat-form-field",6)(7,"mat-label"),o(8,"Nome"),t(),f(9,"input",7),a(10,"mat-icon",8),o(11,"person"),t(),u(12,Pe,2,0,"mat-error",9),t(),a(13,"mat-form-field",6)(14,"mat-label"),o(15,"CPF"),t(),a(16,"input",10),v("input",function(s){return g(d),E(i.formatCPF(s))}),t(),a(17,"mat-icon",8),o(18,"fingerprint"),t(),u(19,Te,2,0,"mat-error",9)(20,qe,2,0,"mat-error",9),t()(),a(21,"div",5)(22,"mat-form-field",6)(23,"mat-label"),o(24,"E-mail"),t(),f(25,"input",11),a(26,"mat-icon",8),o(27,"email"),t(),u(28,Ne,2,0,"mat-error",9)(29,ke,2,0,"mat-error",9)(30,we,2,0,"mat-error",9),t(),a(31,"mat-form-field",6)(32,"mat-label"),o(33,"Telefone"),t(),a(34,"input",12),v("input",function(s){return g(d),E(i.formatPhone(s))}),t(),a(35,"mat-icon",8),o(36,"phone"),t(),u(37,Oe,2,0,"mat-error",9)(38,Ve,2,0,"mat-error",9),t()(),a(39,"mat-form-field",6)(40,"mat-label"),o(41,"Endere\xE7o"),t(),f(42,"input",13),a(43,"mat-icon",8),o(44,"location_on"),t(),u(45,Xe,2,0,"mat-error",9),t(),a(46,"div",5)(47,"mat-form-field",6)(48,"mat-label"),o(49,"Contrato"),t(),f(50,"input",14),a(51,"mat-icon",8),o(52,"description"),t(),u(53,Ae,2,0,"mat-error",9),t(),a(54,"mat-form-field",6)(55,"mat-label"),o(56,"Cargo"),t(),f(57,"input",15),a(58,"mat-icon",8),o(59,"work"),t(),u(60,$e,2,0,"mat-error",9),t()(),a(61,"div",5)(62,"mat-form-field",6)(63,"mat-label"),o(64,"Data de Pagamento"),t(),f(65,"input",16)(66,"mat-datepicker-toggle",17)(67,"mat-datepicker",null,0),u(69,Be,2,0,"mat-error",9),t(),a(70,"mat-form-field",6)(71,"mat-label"),o(72,"Data das F\xE9rias"),t(),f(73,"input",18)(74,"mat-datepicker-toggle",17)(75,"mat-datepicker",null,1),u(77,Re,2,0,"mat-error",9),t()(),a(78,"div",5)(79,"mat-form-field",6)(80,"mat-label"),o(81,"Sal\xE1rio"),t(),f(82,"input",19),a(83,"span",20),o(84,"R$\xA0"),t(),u(85,je,2,0,"mat-error",9),t(),a(86,"mat-form-field",6)(87,"mat-label"),o(88,"Senha"),t(),f(89,"input",21),a(90,"mat-icon",8),o(91,"lock"),t(),u(92,Ge,2,0,"mat-error",9)(93,Le,2,0,"mat-error",9),t()(),a(94,"div",22)(95,"button",23)(96,"mat-icon"),o(97),t(),o(98),t()()()()}if(r&2){let d,c,s,F,x,S,M,D,I,P,T,q,N,k,w,O,V=C(68),X=C(76);m(3),b(i.isEdit?"Editar Funcion\xE1rio":"Novo Funcion\xE1rio"),m(),l("formGroup",i.form),m(8),l("ngIf",(d=i.form.get("nome"))==null?null:d.hasError("required")),m(7),l("ngIf",(c=i.form.get("cpf"))==null?null:c.hasError("required")),m(),l("ngIf",(s=i.form.get("cpf"))==null?null:s.hasError("invalidCpf")),m(8),l("ngIf",(F=i.form.get("email"))==null?null:F.hasError("required")),m(),l("ngIf",(x=i.form.get("email"))==null?null:x.hasError("email")),m(),l("ngIf",(S=i.form.get("email"))==null?null:S.hasError("invalidCompanyEmail")),m(7),l("ngIf",(M=i.form.get("telefone"))==null?null:M.hasError("required")),m(),l("ngIf",(D=i.form.get("telefone"))==null?null:D.hasError("pattern")),m(7),l("ngIf",(I=i.form.get("endereco"))==null?null:I.hasError("required")),m(8),l("ngIf",(P=i.form.get("contrato"))==null?null:P.hasError("required")),m(7),l("ngIf",(T=i.form.get("role"))==null?null:T.hasError("required")),m(5),l("matDatepicker",V),m(),l("for",V),m(3),l("ngIf",(q=i.form.get("data_pagamento"))==null?null:q.hasError("pastDate")),m(4),l("matDatepicker",X),m(),l("for",X),m(3),l("ngIf",(N=i.form.get("data_ferias"))==null?null:N.hasError("futureDate")),m(8),l("ngIf",(k=i.form.get("salario"))==null?null:k.hasError("min")),m(4),l("required",!i.isEdit),m(3),l("ngIf",(w=i.form.get("senha"))==null?null:w.hasError("required")),m(),l("ngIf",(O=i.form.get("senha"))==null?null:O.hasError("minlength")),m(2),l("disabled",i.form.invalid),m(2),b(i.isEdit?"save":"person_add"),m(),B(" ",i.isEdit?"Salvar Altera\xE7\xF5es":"Cadastrar Funcion\xE1rio"," ")}},dependencies:[j,R,re,Y,H,Z,U,W,Q,ee,K,z,J,ae,ie,de,pe,oe,ne,me,le,fe,ue,ce,se,Fe,ye,Ce,be,xe,he,ge,_e,ve],styles:[".form-card[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:2rem;border-radius:16px;overflow:hidden}.form-header[_ngcontent-%COMP%]{margin-bottom:2rem}.form-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--primary-color)}.form-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1.5rem}.form-row[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{flex:1}.form-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary)}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem}.submit-button[_ngcontent-%COMP%]{min-width:200px}.cancel-button[_ngcontent-%COMP%]{border-color:var(--text-secondary);color:var(--text-secondary)}mat-datepicker-toggle[_ngcontent-%COMP%]{color:var(--text-secondary)}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:1.5rem;margin:1rem}.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.submit-button[_ngcontent-%COMP%], .cancel-button[_ngcontent-%COMP%]{width:100%}}"]})};export{Se as EmployeeFormComponent};
