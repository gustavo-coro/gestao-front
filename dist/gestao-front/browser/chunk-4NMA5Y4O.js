import{a as te}from"./chunk-GFX6PFIB.js";import{a as oe}from"./chunk-JBCGYZPP.js";import{A as z,B as Z,F as H,G as K,b as O,d as s,f as N,g as T,j as q,l as V,m as A,o as R,q as w,s as D,t as B,u as J,x as L}from"./chunk-KWAF5XDU.js";import{a as G,f as k,g as ee}from"./chunk-EMEIIDOM.js";import{a as P,c as X}from"./chunk-BB7POGC6.js";import{Ab as v,Bb as y,Da as m,Ha as c,Oa as I,Ta as d,Za as p,a as C,cd as Q,dd as U,e as ie,ed as W,fc as $,fd as Y,gb as i,hb as n,ib as g,jc as j,ob as _,zb as o}from"./chunk-MQA6ALZQ.js";var ne=ie(oe());function ae(a,r){a&1&&(i(0,"mat-error"),o(1," Nome \xE9 obrigat\xF3rio "),n())}function me(a,r){a&1&&(i(0,"mat-error"),o(1," CPF/CNPJ \xE9 obrigat\xF3rio "),n())}function le(a,r){a&1&&(i(0,"mat-error"),o(1," CPF inv\xE1lido "),n())}function pe(a,r){a&1&&(i(0,"mat-error"),o(1," CNPJ inv\xE1lido "),n())}function ue(a,r){a&1&&(i(0,"mat-error"),o(1," Telefone \xE9 obrigat\xF3rio "),n())}function fe(a,r){a&1&&(i(0,"mat-error"),o(1," Formato: (XX) XXXX-XXXX ou (XX) XXXXX-XXXX "),n())}function se(a,r){a&1&&(i(0,"mat-error"),o(1," E-mail \xE9 obrigat\xF3rio "),n())}function de(a,r){a&1&&(i(0,"mat-error"),o(1," Formato de e-mail inv\xE1lido "),n())}function ce(a,r){a&1&&(i(0,"mat-error"),o(1," E-mail deve terminar com .com.br "),n())}function ge(a,r){a&1&&(i(0,"mat-error"),o(1," Endere\xE7o \xE9 obrigat\xF3rio "),n())}var re=class a{constructor(r,t,e,l){this.fb=r;this.api=t;this.router=e;this.route=l}form;isEdit=!1;supplierIdFromRoute;ngOnInit(){this.form=this.fb.group({nome_fornecedor:["",s.required],cpf_cnpj_fornecedor:["",[s.required,this.validateCpfCnpj]],email_fornecedor:["",[s.required,s.email,this.validateCompanyEmail]],telefone_fornecedor:["",[s.required,s.pattern(/^\(\d{2}\) \d{4,5}-\d{4}$/)]],endereco_fornecedor:["",s.required]});let r=this.route.snapshot.paramMap.get("cpf_cnpj_fornecedor");r&&(this.isEdit=!0,this.supplierIdFromRoute=r,this.api.getSupplier(this.supplierIdFromRoute).subscribe(t=>{let e=C({},t);e.cpf_cnpj_fornecedor&&(e.cpf_cnpj_fornecedor=this.applyCpfCnpjMask(String(e.cpf_cnpj_fornecedor))),this.form.patchValue(e)}))}applyCpfCnpjMask(r){let t=r.replace(/\D/g,""),e=t;if(t.length<=11)e=t.replace(/(\d{3})(\d)/,"$1.$2"),e=e.replace(/(\d{3})(\d)/,"$1.$2"),e=e.replace(/(\d{3})(\d{1,2})$/,"$1-$2"),t.length<=3?e=t:t.length<=6?e=`${t.substring(0,3)}.${t.substring(3)}`:t.length<=9?e=`${t.substring(0,3)}.${t.substring(3,6)}.${t.substring(6)}`:e=`${t.substring(0,3)}.${t.substring(3,6)}.${t.substring(6,9)}-${t.substring(9,11)}`;else{if(e=t.substring(0,14),e.length<=2)return e;if(e.length<=5)return`${e.substring(0,2)}.${e.substring(2)}`;if(e.length<=8)return`${e.substring(0,2)}.${e.substring(2,5)}.${e.substring(5)}`;if(e.length<=12)return`${e.substring(0,2)}.${e.substring(2,5)}.${e.substring(5,8)}/${e.substring(8)}`;e=`${e.substring(0,2)}.${e.substring(2,5)}.${e.substring(5,8)}/${e.substring(8,12)}-${e.substring(12,14)}`}return e}validateCpfCnpj(r){let t=r.value.replace(/\D/g,"");return t.length===0&&!r.hasError("required")?null:t.length===11?(0,ne.isValid)(t)?null:{invalidCpf:!0}:t.length===14?te(t)?null:{invalidCnpj:!0}:t.length>0&&t.length<11?{invalidCpfCnpjLength:!0}:t.length>11&&t.length<14?{invalidCpfCnpjLength:!0}:null}validateCompanyEmail(r){let t=r.value;return t&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(t)?{invalidEmailFormat:!0}:null}formatCpfCnpj(r){let e=r.target.value,l=this.applyCpfCnpjMask(e);this.form.get("cpf_cnpj_fornecedor")?.setValue(l,{emitEvent:!1})}formatPhone(r){let t=r.target.value.replace(/\D/g,""),e="";if(t.length>0&&(e=`(${t.substring(0,2)}`),t.length>2){let l=t.substring(2);if(l.length>0)if(e+=") ",t.length<=10){let u=l.substring(0,4),f=l.substring(4,8);e+=u,f&&(e+=`-${f}`)}else{let u=l.substring(0,5),f=l.substring(5,9);e+=u,f&&(e+=`-${f}`)}}this.form.get("telefone_fornecedor")?.setValue(e.substring(0,15),{emitEvent:!1})}onSubmit(){if(this.form.invalid){Object.values(this.form.controls).forEach(e=>{e.markAsTouched()}),console.warn("Formul\xE1rio inv\xE1lido:",this.form.errors,this.form.value);return}let r=C({},this.form.value);r.cpf_cnpj_fornecedor&&(r.cpf_cnpj_fornecedor=String(r.cpf_cnpj_fornecedor).replace(/\D/g,"")),console.log("onSubmit supplier (dados limpos):",r),(this.isEdit?this.api.updateSupplier(this.supplierIdFromRoute,r):this.api.createSupplier(r)).subscribe({next:e=>{console.log("Fornecedor salvo com sucesso",e),this.router.navigate(["/fornecedor"])},error:e=>console.error("Erro ao salvar fornecedor:",e)})}static \u0275fac=function(t){return new(t||a)(c(w),c(ee),c(X),c(P))};static \u0275cmp=I({type:a,selectors:[["app-supplier-form"]],decls:51,vars:15,consts:[[1,"form-card"],[1,"form-header"],[1,"form-content",3,"ngSubmit","formGroup"],["appearance","outline",1,"form-field"],["matInput","","formControlName","nome_fornecedor","required",""],["matSuffix",""],[4,"ngIf"],[1,"form-row"],["matInput","","formControlName","cpf_cnpj_fornecedor","placeholder","000.000.000-00 ou 00.000.000/0000-00","required","",3,"input"],["matInput","","formControlName","telefone_fornecedor","placeholder","(XX) XXXX-XXXX","required","",3,"input"],["matInput","","formControlName","email_fornecedor","type","email","required",""],["matInput","","formControlName","endereco_fornecedor","required",""],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",1,"submit-button",3,"disabled"]],template:function(t,e){if(t&1&&(i(0,"mat-card",0)(1,"div",1)(2,"h2"),o(3),n()(),i(4,"form",2),_("ngSubmit",function(){return e.onSubmit()}),i(5,"mat-form-field",3)(6,"mat-label"),o(7,"Nome"),n(),g(8,"input",4),i(9,"mat-icon",5),o(10,"business"),n(),d(11,ae,2,0,"mat-error",6),n(),i(12,"div",7)(13,"mat-form-field",3)(14,"mat-label"),o(15,"CPF/CNPJ"),n(),i(16,"input",8),_("input",function(u){return e.formatCpfCnpj(u)}),n(),i(17,"mat-icon",5),o(18,"fingerprint"),n(),d(19,me,2,0,"mat-error",6)(20,le,2,0,"mat-error",6)(21,pe,2,0,"mat-error",6),n(),i(22,"mat-form-field",3)(23,"mat-label"),o(24,"Telefone"),n(),i(25,"input",9),_("input",function(u){return e.formatPhone(u)}),n(),i(26,"mat-icon",5),o(27,"phone"),n(),d(28,ue,2,0,"mat-error",6)(29,fe,2,0,"mat-error",6),n()(),i(30,"mat-form-field",3)(31,"mat-label"),o(32,"E-mail"),n(),g(33,"input",10),i(34,"mat-icon",5),o(35,"email"),n(),d(36,se,2,0,"mat-error",6)(37,de,2,0,"mat-error",6)(38,ce,2,0,"mat-error",6),n(),i(39,"mat-form-field",3)(40,"mat-label"),o(41,"Endere\xE7o"),n(),g(42,"input",11),i(43,"mat-icon",5),o(44,"location_on"),n(),d(45,ge,2,0,"mat-error",6),n(),i(46,"div",12)(47,"button",13)(48,"mat-icon"),o(49),n(),o(50),n()()()()),t&2){let l,u,f,b,h,E,S,F,M,x;m(3),v(e.isEdit?"Editar Fornecedor":"Novo Fornecedor"),m(),p("formGroup",e.form),m(7),p("ngIf",(l=e.form.get("nome_fornecedor"))==null?null:l.hasError("required")),m(8),p("ngIf",(u=e.form.get("cpf_cnpj_fornecedor"))==null?null:u.hasError("required")),m(),p("ngIf",(f=e.form.get("cpf_cnpj_fornecedor"))==null?null:f.hasError("invalidCpf")),m(),p("ngIf",(b=e.form.get("cpf_cnpj_fornecedor"))==null?null:b.hasError("invalidCnpj")),m(7),p("ngIf",(h=e.form.get("telefone_fornecedor"))==null?null:h.hasError("required")),m(),p("ngIf",(E=e.form.get("telefone_fornecedor"))==null?null:E.hasError("pattern")),m(7),p("ngIf",(S=e.form.get("email_fornecedor"))==null?null:S.hasError("required")),m(),p("ngIf",(F=e.form.get("email_fornecedor"))==null?null:F.hasError("email")),m(),p("ngIf",(M=e.form.get("email_fornecedor"))==null?null:M.hasError("invalidCompanyEmail")),m(7),p("ngIf",(x=e.form.get("endereco_fornecedor"))==null?null:x.hasError("required")),m(2),p("disabled",e.form.invalid),m(2),v(e.isEdit?"save":"add"),m(),y(" ",e.isEdit?"Salvar":"Criar"," ")}},dependencies:[j,$,D,q,O,N,T,R,V,A,k,G,Z,z,B,J,L,K,H,U,Q,Y,W],styles:[".form-card[_ngcontent-%COMP%]{max-width:800px;margin:2rem auto;padding:2rem;border-radius:16px;overflow:hidden}.form-header[_ngcontent-%COMP%]{margin-bottom:2rem}.form-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:.5rem;color:var(--primary-color)}.form-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1.5rem}.form-row[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{flex:1}.form-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:var(--text-secondary)}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem}.submit-button[_ngcontent-%COMP%]{min-width:120px}.cancel-button[_ngcontent-%COMP%]{border-color:var(--text-secondary);color:var(--text-secondary)}@media (max-width: 768px){.form-card[_ngcontent-%COMP%]{padding:1.5rem;margin:1rem}.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.submit-button[_ngcontent-%COMP%], .cancel-button[_ngcontent-%COMP%]{width:100%}}"]})};export{re as SupplierFormComponent};
